<!DOCTYPE html>
<html lang="ru">
<meta charset="utf-8">

<link rel="icon" href="https://ru.siberianhealth.com/shopen/public/icon.svg" type="image/svg+xml">
<title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ä–µ–∫–ª–∞–º—ã –Ω–∞–±–æ—Ä–æ–≤</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Jost:wght@400;500&display=swap');
body{
overflow-y:scroll;
font-family:Jost;
font-weight:400;
color:#333;
background:#f8f8f8;
padding:60px 0;
margin:0;
}

#pics{
position:absolute;
text-align:center;
}
.pic{
height:200px;
vertical-align:bottom;
}
.pic:hover{
opacity:.5;
}

input{
display:none;
}
label{
cursor:pointer;
position:relative;
}
.checked{
display:none;
position:absolute;
bottom:15px;
left:15px;
background:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMmM4N2ZjIiBkPSJNMTkgMGgtMTRjLTIuNzYyIDAtNSAyLjIzOS01IDV2MTRjMCAyLjc2MSAyLjIzOCA1IDUgNWgxNGMyLjc2MiAwIDUtMi4yMzkgNS01di0xNGMwLTIuNzYxLTIuMjM4LTUtNS01em0tOC45NTkgMTdsLTQuNS00LjMxOSAxLjM5NS0xLjQzNSAzLjA4IDIuOTM3IDcuMDIxLTcuMTgzIDEuNDIyIDEuNDA5LTguNDE4IDguNTkxeiIvPjwvc3ZnPg==);
background-size:20px;
width:20px;
height:20px;
}
input:checked+label .checked{
display:block;
}

#wrap_canvas{
width:300px;
margin:auto;
}
#canvas{
border-radius:20px;
width:300px;
cursor:pointer;
}

#copied{
color:#F2685c;
font-size:.9em;
display:none;
position:fixed;
top:13px;
right:20px;
}


#copy{
text-align-last:justify;
position:fixed;
top:13px;
left:20px;
}
#copy button{
cursor:pointer;
padding:5px 15px;
border-radius:20px;
background:transparent;
font-family:inherit;
font-size:inherit;
}
#copy button:disabled{
color:#bfbfbf;
border:1px solid #ddd;
}
#copy button:disabled.dark_theme{
color:#888;
border:1px solid #888;
}
#wa{
color:#00A884;
border:1px solid #00A884;
margin-right:5px;
}
#tg{
color:#179CDE;
border:1px solid #179CDE;
}



#step_text{
position:absolute;
top:13px;
right:20px;
cursor:pointer;
padding:5px 15px;
border-radius:20px;
background:transparent;
font-family:inherit;
font-size:inherit;
color:#F2685c;
border:1px solid #F2685c;
}
#step_text:disabled{
color:#bfbfbf;
border:1px solid #ddd;
}

.inactive{
display:none;
}



[contenteditable]{
background:#fff;
border-radius:20px;
padding:15px;
margin:20px auto 0;
width:470px;
resize:none;
cursor:text;
outline:none;
appearance:none;
-webkit-appearance:none;
-moz-appearance:none;
text-decoration:none;
}
[contenteditable] b{
font-weight:500;
}
[contenteditable] p{
padding:0;
margin:1em 0 0;
}
[contenteditable] p:first-child{
margin:0;
}

#text_length{
font-size:.9em;
position:fixed;
bottom:13px;
right:20px;
}
#text_length.overlimit{
color:#F2685c;
}
#text_length.overlimit:before{
content:'–°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π —Ç–µ–∫—Å—Ç! ';
}
#text_length:after{
content:' / 1024';
}
</style>

<button id="step_text" disabled>–í—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã</button>

<div class="step_pic">
	<div id="screenshot">
		<div id="pics"></div>
	</div>
</div>

<div class="step_text inactive">
	<div id="copy"><button id="wa">–í–∞—Ü–∞–ø</button><button id="tg">–¢–µ–ª–µ–≥–∞</button></div>

	<div id="wrap_canvas">
		<canvas id="canvas"></canvas>
	</div>

	<div id="copied">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!</div>

	<div id="text_length"></div>

	<div contenteditable></div>
</div>

<script src="https://yastatic.net/jquery/3.3.1/jquery.min.js"></script>
<script>
$(document).click(function(e){ //–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –∫–∞—Ä—Ç–∏–Ω–æ–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–æ–ª–µ
	var clickOut=$('input,img'); //–ö–∞–∫ —ç—Ç–æ –ø–æ–Ω–∏–º–∞—Ç—å??? –†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –ø–æ—á–µ–º—É —Ç–æ–ª—å–∫–æ —Ç–∞–∫?
	if(!clickOut.is(e.target)&&!clickOut.has(e.target).length){
		$('input').prop('checked',false);
	}
});

$('[contenteditable]').on('paste keyup',function(){
	$('#text_length').text($('[contenteditable]').html().length);
	if($('[contenteditable]').html().length>1024){
		$('#text_length').addClass('overlimit');
		$('#copy button').prop('disabled',true);
	}else{
		$('#text_length').removeClass('overlimit');
		$('#copy button').prop('disabled',false);
	}
});

// –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –¥–∞—Ç—ã —Å—Ä–µ–¥—ã
function wednesday(date=new Date()){
	var day=date.getDay();
	var diff=(day<=3)?3-day:10-day;
	date.setDate(date.getDate()+diff);
	var options={day:'numeric',month:'long'};
	return date.toLocaleDateString('ru-RU',options);
}

// –°–∫–ª–æ–Ω–µ–Ω–∏–µ —Å–ª–æ–≤
function declension(qty,titles){
	let declension=new Array(2,0,1,1,1,2);
	return qty+' '+titles[(qty%1!=0)?1:(qty%100>4&&qty%100<20)?2:declension[Math.min(qty%10,5)]];
}

function reset(){ //–§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è)
	$('#screenshot').width(0).height(0);
	$('#pics').css('margin',0).html($('#pics').html().replace(/(?:<br>){2,}/g,'<br>'));
	$('input:first').prev('br').remove();
}

var categoryChains; //–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–µ—Å–ø—Ä–æ–±–ª–µ–º–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Å —Å–∞–π—Ç–∞ SW
var cityId; //–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–µ—Å–ø—Ä–æ–±–ª–µ–º–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Å —Å–∞–π—Ç–∞ SW
var params; //–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –±–µ—Å–ø—Ä–æ–±–ª–µ–º–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Å —Å–∞–π—Ç–∞ SW
var successfulPaste=0;
var discount;
//function elemArray(arr,val){ //—Ñ—É–Ω–∫—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É —ç–ª–µ–º–µ–Ω—Ç–∞ –º–∞—Å—Å–∏–≤–∞ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é –≤ –ª—é–±–æ–º –∏–∑ –µ–≥–æ –ø–æ–¥—ç–ª–µ–º–µ–Ω—Ç–æ–≤
//	return arr.findIndex(subarray=>subarray.includes(String(val)));
//}
$(document).on('paste',function(e){ //–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É —á–µ—Ä–µ–∑ –≤—Å—Ç–∞–≤–∫—É –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ –∞–¥—Ä–µ—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–¥—É–∫—Ç–∞ —Å —Å–∞–π—Ç–∞ SW (Ctrl+V)
	if(successfulPaste>0){
		<!-- alert('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞! –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥—Ä—É–≥–æ–π –Ω–∞–±–æ—Ä'); -->
	}else{
		navigator.clipboard.readText().then(text=>{
			let excel=text.replace(/\r\n$/,'').split(/\r\n|\r|\n/).map(row=>row.split('\t'));
			function paste(i){
				$('#step_text').text('–ó–∞–≥—Ä—É–∑–∫–∞...');
				if(i>=excel.length){
					if(successfulPaste==0){
						alert('–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –í–æ–∑–º–æ–∂–Ω–æ, –∞—Ä—Ç–∏–∫—É–ª—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã, —Å–∞–π—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
					}else{
						$('#step_text').text('–ì–æ—Ç–æ–≤–æ! –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç').prop('disabled',false);
						<!-- if(excel[0][0]=='–ü–ú–ì'){ -->
							<!-- $('[contenteditable]').prepend('–ê–∫—Ü–∏—è ¬´–°—á–∞—Å—Ç–ª–∏–≤–∞—è —Å—Ä–µ–¥–∞¬ª / '+wednesday()+'!<br>'); -->
						<!-- } -->
						<!-- else if(excel[0][0].match('–ë–æ–º–±–∞ –æ—Ñ—Ñ–µ—Ä')){ -->
							<!-- $('[contenteditable]').prepend(excel[0][0].replaceAll('"','').replace('–ë–æ–º–±–∞ –æ—Ñ—Ñ–µ—Ä ','–ê–∫—Ü–∏—è –Ω–µ–¥–µ–ª–∏!<br>')+'<br>'); -->
						<!-- } -->
						<!-- else{ -->
							<!-- $('[contenteditable]').prepend(excel[0][0]+'<br>'); -->
						<!-- } -->
						<!-- console.log(excel.some(row=>row[4]==='1,00')) // —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞, –µ—Å—Ç—å –ª–∏ –≤ –Ω—É–∂–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ –Ω—É–∂–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ -->
						discount=excel[1][4].replace('0,','');
					}
					return;
				}
				if(excel[i][1].trim().match(/^\d{6}$/)){
					$.post('https://ru.siberianhealth.com/ru/shop/catalog/product/'+excel[i][1].trim()+'/',function(data){
						let sendData=eval('({'+data.match(/\'id\'\: \d{6}\,/)+data.split(/\'id\'\: \d{6}\,/)[1].split("'params': params")[0]+'})');

						sendData.name=sendData.name
							.replace(/\, 1\.5 –º–ª|\, 1\,5 –º–ª/,' (1,5 –º–ª)')
							.replace(/\, (\d{2,3} –º–ª)/,' ($1)')
							.replace(/\, (\d{2,3} –≥)/,' ($1)')
							.replace(/\, (–æ–±—ä–µ–º \d{2,3} –º–ª)/,' ($1)')
							.replace('–î—É—Ö–∏-–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç,','–î—É—Ö–∏-–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç')
							.replace('–§–∏—Ç–æ—á–∞–π –∏–∑ –¥–∏–∫–∏—Ö —Ç—Ä–∞–≤ ‚Ññ ','–ß–∞–π ‚Ññ')
							.replace(/^–í–∏—Ç–∞–º–∏–Ω–Ω–æ-–º–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å$/,sendData.vendor)
							.replace(/^–≠–Ω–µ—Ä–≥–æ–º–æ–¥—É–ª–∏—Ä—É—é—â–∏–π –∫–æ–º–ø–ª–µ–∫—Å –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ø—Ä–µ—è$/,sendData.vendor)
							.replace(/^–ù–∞–±–æ—Ä –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞$/,sendData.vendor)
							.replace(/^–ü—Ä–µ–º–∏—É–º –Ω–∞–±–æ—Ä –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ –æ—á–∏—â–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–∞$/,'–ò—Å—Ç–æ–∫–∏ —á–∏—Å—Ç–æ—Ç—ã –ü—Ä–µ–º–∏—É–º (Renaissance Triple Set)')
							.replace(/^–ò—Å—Ç–æ–∫–∏ —á–∏—Å—Ç–æ—Ç—ã. –§–æ—Ä–º—É–ª–∞ 3$/,'–§–æ—Ä–º—É–ª–∞ 3')
							.replace(/^(–ü—Ä–∏—Ä–æ–¥–Ω—ã–π –∏–Ω—É–ª–∏–Ω–æ–≤—ã–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ç)$/,'$1 (–ü–ò–ö)')
							.replace(/^(–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π –±–∞–ª—å–∑–∞–º)$/,'$1 (–¥–ª—è –∫–æ–∂–∏)')
							.replace(/^–ë–∞–ª—å–∑–∞–º —Å —ç–∫—Å—Ç—Ä–∞–∫—Ç–æ–º –æ–∫–æ–ø–Ω–∏–∫–∞\, –≥–ª—é–∫–æ–∑–∞–º–∏–Ω–æ–º –∏ —Ö–æ–Ω–¥—Ä–æ–∏—Ç–∏–Ω–æ–º$/,sendData.vendor)
							.replace(/^¬´–ñ–∏–≤–æ–∫–æ—Å—Ç¬ª, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—â–∏–π –±–∞–ª—å–∑–∞–º —Ñ–æ—Ä—Ç–µ$/,'–ë–∞–ª—å–∑–∞–º –ñ–∏–≤–æ–∫–æ—Å—Ç —Ñ–æ—Ä—Ç–µ')
							.replace(/^\¬´–£—è–Ω –ù–æ–º–æ\¬ª\, –±–∞–ª—å–∑–∞–º –¥–ª—è —Ç–µ–ª–∞$/,'–ë–∞–ª—å–∑–∞–º –£—è–Ω –ù–æ–º–æ (–ì–∏–±–∫–∏–π –ª—É–∫)')
							.replace(/^(–ë–∞–ª—å–∑–∞–º —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è)$/,'$1 –ö–æ—Ä–µ–Ω—å (–±–µ–∑ –∫–∞–º—Ñ–æ—Ä—ã)')
							.replace(/^(–ë–∞–ª—å–∑–∞–º —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞ –¥–µ–π—Å—Ç–≤–∏—è) ¬´–ö–æ—Ä–µ–Ω—å¬ª$/,'$1 –ö–æ—Ä–µ–Ω—å (—Å –∫–∞–º—Ñ–æ—Ä–æ–π)')
							.replace(/^(–ó—É–±–Ω–∞—è –ø–∞—Å—Ç–∞|–ó—É–±–Ω–∞—è –ø–∞—Å—Ç–∞ —Å –ø—Ä–µ–±–∏–æ—Ç–∏–∫–æ–º) (–ù–∞—Ç—É—Ä–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞|–ê–Ω—Ç–∏–±–∞–∫—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞|–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ —É–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —ç–º–∞–ª–∏|–°–≤–µ–∂–µ—Å—Ç—å –∏ –∑–∞—â–∏—Ç–∞ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∑—É–±–æ–≤)$/,'$1 '+sendData.vendor+' ($2)')
							.replace(/^–•—Ä–æ–Ω–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –∫–ª–µ—Ç–æ–∫ –º–æ–∑–≥–∞$|^–•—Ä–æ–Ω–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —Å–µ—Ä–¥—Ü–∞$|^–•—Ä–æ–Ω–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –ø–µ—á–µ–Ω–∏$|^–•—Ä–æ–Ω–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ —Å—É—Å—Ç–∞–≤–æ–≤$|^–•—Ä–æ–Ω–æ–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –∑—Ä–µ–Ω–∏—è$/,sendData.vendor+' ('+sendData.name+')')
							.replace('. ',', ');
						if(sendData.name.match(', ')&&sendData.name.trim().match(/^[^–ê-–Ø–Å–∞-—è—ë]{3}|–ö–æ—Ä–µ–Ω—å/)&&!sendData.name.trim().match('100%')){
							sendData.name=sendData.name.replace(sendData.name.split(', ')[0]+', ','').replace(/^./,char=>char.toUpperCase())+' '+sendData.name.split(', ')[0];
						}
						if(sendData.name.match(' / ')){
							sendData.name=sendData.name.trim().replace(' / ',' (')+')';
						}
						var measurements=/ \(1\,5 –º–ª\)| \(\d{2,3} –º–ª\)| \(\d{2,3} –≥\)| \(–æ–±—ä–µ–º \d{2,3} –º–ª\)/;
						if(sendData.name.match(measurements)){
							sendData.name=sendData.name.replace(sendData.name.match(measurements),'')+sendData.name.match(measurements);
						}
						
						var oldPrice=(excel[i][5].match('-'))?declension(excel[i][3].replace(/\D/g,''),new Array('—Ä—É–±–ª—å','—Ä—É–±–ª—è','—Ä—É–±–ª–µ–π')):excel[i][3].replace(/\D/g,'');

						var price=(excel[i][5].match('-'))?'–≤ –ø–æ–¥–∞—Ä–æ–∫':(excel[i][5].trim()=='')?declension(excel[i][3]*(1-+excel[i][4].replace(',','.')),new Array('—Ä—É–±–ª—å','—Ä—É–±–ª—è','—Ä—É–±–ª–µ–π')):declension(excel[i][5].replace(/\D/g,''),new Array('—Ä—É–±–ª—å','—Ä—É–±–ª—è','—Ä—É–±–ª–µ–π'));

						var points=(excel[i][6].match('-'))?excel[i][6]='':(excel[i][6].trim()=='')?'':'/'+declension(excel[i][6].trim().replace(',0',''),new Array('–±–∞–ª–ª','–±–∞–ª–ª–∞','–±–∞–ª–ª–æ–≤'));

						sendData.description=sendData.description.replace(/\.([–ê-–ØA-Z0-9\¬´])/g,'<br>$1').replace(/\.\¬´/g,'<br>\¬´').replace(/([‚Ä¶!üôÇ])([–ê-–ØA-Z0-9])/g,'$1<br>$2').trim().replace(/\.$/gm,'');

						$('#pics').append('<input type="checkbox" id="p_'+successfulPaste+'"><label for="p_'+successfulPaste+'"><img crossorigin id="pic_'+successfulPaste+'" class="pic" src="'+sendData.pictureUrl.replace('_resize/','').replace('_fit_300_300','')+'"><div class="checked"></div></label>');

						$('[contenteditable]').append(
							'<p id="par_'+successfulPaste+'"><b>- '
							+sendData.name
							+' –∑–∞ <s>'
							+oldPrice
							+'</s> '
							+price
							+points
							+'</b>'
							<!-- +'. ' -->
							<!-- +sendData.description -->
							+'</p>'
						).html($('[contenteditable]').html().replace(/^(?:<br>){2}/,''));

						successfulPaste++;
						paste(i+1);
					}).fail(function(){
						paste(i+1);
					});
				}else{
					paste(i+1);
				}
			}
			paste(0);
		}).catch(err=>{
			console.log('–û–ø—è—Ç—å —á—ë-—Ç–æ –Ω–µ —Ç–∞–∫',err);
		});
	}
});
$(document).keydown(function(e){
	if(!$('.step_pic').hasClass('inactive')){
		if(e.which==46){ //–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É (Delete)
			for(let i=0;i<successfulPaste;i++){
				if($('input').eq(i).prop('checked')){
					$('#par_'+$('input').eq(i).attr('id').replace(/\D/g,'')).remove();
				}
			}
			$('input:checked,input:checked+label').remove();
			reset();
		}
		if(e.which==13){ //–°–¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ (Enter)
			$('input:checked').before('<br>');
			reset();
		}
		if(e.which==8){ //–û—Ç–º–µ–Ω–∏—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –∫–∞—Ä—Ç–∏–Ω–∫–∏ –Ω–∞ —Å—Ç—Ä–æ–∫—É –Ω–∏–∂–µ (Backspace)
			$('input:checked').prev('br').remove();
			reset();
		}
		if(e.ctrlKey&&e.which==65){ //–í—ã–¥–µ–ª–∏—Ç—å –≤—Å–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏/–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ (Ctrl+A)
			if($('input:checked').length==$('input').length){
				$('input').prop('checked',false);
				return false;
			}else{
				$('input').prop('checked',true);
				return false;
			}
		}
		if(e.which==27){ //–°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫ (Esc)
			$('input').prop('checked',false);
		}
//		if(e.ctrlKey&&e.which==67){ //–†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞–∑–º–µ—Ä—ã –±–µ–ª–æ–≥–æ –ø–æ–ª–æ—Ç–Ω–∞ –¥–ª—è —Å–∫—Ä–∏–Ω—à–æ—Ç–∞ –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –µ—ë –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ (Ctrl+C)
//		}
	}
});

$('#step_text').click(function(){
	$('#text_length').text($('[contenteditable]').html().length);
	if($('[contenteditable]').html().length>1024){
		$('#text_length').addClass('overlimit');
		$('#copy button').prop('disabled',true);
	}else{
		$('#text_length').removeClass('overlimit');
		$('#copy button').prop('disabled',false);
	}

	var prod_disc=$('[contenteditable]').text().match(/–∑–∞ \d+ \d+ (—Ä—É–±–ª—å|—Ä—É–±–ª—è|—Ä—É–±–ª–µ–π)/g)?'1 –ø—Ä–æ–¥—É–∫—Ç —Å–æ —Å–∫–∏–¥–∫–æ–π '+discount+'%':'';
	var and=$('[contenteditable]').text().match(/–∑–∞ \d+ \d+ (—Ä—É–±–ª—å|—Ä—É–±–ª—è|—Ä—É–±–ª–µ–π)/g)&&$('[contenteditable]').text().match(/–∑–∞ \d+ (—Ä—É–±–ª—å|—Ä—É–±–ª—è|—Ä—É–±–ª–µ–π) –≤ –ø–æ–¥–∞—Ä–æ–∫/g)?' –∏ ':'';
	var prod_gift=$('[contenteditable]').text().match(/–∑–∞ \d+ (—Ä—É–±–ª—å|—Ä—É–±–ª—è|—Ä—É–±–ª–µ–π) –≤ –ø–æ–¥–∞—Ä–æ–∫/g)?'1 –ø—Ä–æ–¥—É–∫—Ç –≤ –ø–æ–¥–∞—Ä–æ–∫':'';

	$('[contenteditable]').prepend(
		'–í—ã –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å –∏–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ '
		+prod_disc
		+and
		+prod_gift
		+':<br>'
	);

	reset();
	if($('#pics').width()>=$('#pics').height()){
		$('#screenshot').width($('#pics').width()).height($('#pics').width());
		$('#pics').css('margin-top',($('#pics').width()-$('#pics').height())/2);
	}else{
		$('#screenshot').width($('#pics').height()).height($('#pics').height());
		$('#pics').css('margin-left',($('#pics').height()-$('#pics').width())/2);
	}
	var scale=600/$('.pic').height(); //–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫, —á—Ç–æ–±—ã –æ–Ω–∏ –±—ã–ª–∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ (600 - —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Å —Å–∞–π—Ç–∞ SW)
	var canvas=document.querySelector('#canvas');
	canvas.width=document.querySelector('#screenshot').offsetWidth*scale;
	canvas.height=document.querySelector('#screenshot').offsetHeight*scale;
	var context=canvas.getContext('2d');
	context.clearRect(0,0,canvas.width,canvas.height);
	context.fillStyle='#fff';
	context.fillRect(0,0,canvas.width,canvas.height);
	for(let i=0;i<successfulPaste;i++){
		var pic=document.querySelector('#pic_'+i);
		if(pic!=null){
			pic.left=($('#pic_'+i).offset().left-$('#screenshot').offset().left)*scale;
			pic.top=($('#pic_'+i).offset().top-$('#screenshot').offset().top)*scale;
			context.drawImage(pic,pic.left,pic.top,pic.width*scale,pic.height*scale);
		}
	}
	$('#step_text,.step_pic').addClass('inactive');
	$('#step_pic,.step_text').removeClass('inactive');
});

$('#canvas').click(function(){
	document.querySelector('#canvas').toBlob(blob=>navigator.clipboard.write([new ClipboardItem({'image/png':blob})]));
	$('#copied').fadeIn(100).fadeOut(1000);
});

$('#wa,#tg').click(function(){
	if($(this).attr('id')=='wa'){
		var bold='*';
		var scratch='~';
	}
	if($(this).attr('id')=='tg'){
		var bold='**';
		var scratch='~~';
	}
	navigator.clipboard.writeText(
		$('[contenteditable]').html().replace(/\&amp\;/g,'&').replace('&#039;',"'").replace(/\&nbsp\;|\t/g,' ').replace(/\s+/g,' ').replace(/^\ |\ $/gm,'').replace(/(?:<br>|<div>|<\/div>|<p>|<p id\=\"par\_\d+\">|<\/p>)/g,'\n').replace(/\n{2,}/g,'\n\n').replace(/(?:<s>|<\/s>)/g,scratch).replace(/(?:<b>|<b id\=\"product\">|<\/b>)/g,bold).trim()
	);
	$('#copied').fadeIn(100).fadeOut(1000);
});
</script>
